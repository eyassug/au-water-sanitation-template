

<div class="exportpdfdiv">
<a href="/report/technologiesgapsforthecategorypdf?category={{ category.id }}&start_year={{ start_year }}&end_year={{ end_year }}" target="_blank" class="btn btn-danger exportpdf active" role="button">Export to PDF</a>
</div>
<div class="table-responsive">
<table class="table table-hover table-bordered" id="report_lists">
    <thead id="report_head">
        <tr>
            <th rowspan=2 style="background-color: #CBD5F5;">No</th>
            <th rowspan=2 style="background-color: #CBD5F5;">Priority Area name</th>
            <th colspan=2 style="background-color: #CBD5F5;">Facilities</th>
            <th colspan=5 style="background-color: #CBD5F5;">Gaps (total period)</th>
        </tr>
        <tr>
            <th style="background-color: #CBD5F5;">Character</th>
            <th style="background-color: #CBD5F5;">Technology</th>
            <th style="background-color: #CBD5F5;">Number</th>
            <th style="background-color: #CBD5F5;">Unit Cost(USD)</th>
            <th style="background-color: #CBD5F5;">Total Cost (USD</th>
            <th style="background-color: #CBD5F5;">Govt Contribution(USD)</th>
            <th style="background-color: #CBD5F5;">Population affected</th>
            
        </tr>
    </thead>
<tbody>

{% for gap_c in gaps_by_category %}
{% for gap_fc in gap_c.gaps_by_characteristic %}
{% for gap_t in gap_fc.gaps_by_technology %}
    {% if forloop.first %}
    <tr>
        <td rowspan="{{ rows|add:"1" }}">{{ forloop.parentloop.parentloop.counter }}</td>
        <td rowspan="{{ gap_c.rows }}">{{ gap_c.priority_area }}</td>        
        <td rowspan="{{ gap_fc.rows }}">{{ gap_fc.characteristic }}</td>        
        <td>{{ gap_t.technology }}</td>
        <td>{{ gap_t.number }}</td>       
        <td>{{ gap_t.unit_cost }}</td>
        <td>{{ gap_t.total_cost }}</td>
        <td>{{ gap_t.government_contribution }}</td>
        <td>{{ gap_t.population_affected }}</td>
    </tr>
    {% else %}
    <tr>
        <td>{{ gap_t.technology }}</td>
        <td>{{ gap_t.number }}</td>       
        <td>{{ gap_t.unit_cost }}</td>
        <td>{{ gap_t.total_cost }}</td>
        <td>{{ gap_t.government_contribution }}</td>
        <td>{{ gap_t.population_affected }}</td>    
    </tr>
    {% endif %}
    {% if forloop.last %}
     <tr>
        <td>Total</td>
        <td></td>
        <td></td>
        <td>{{ gap_c.total.number }}</td>       
        <td>{{ gap_c.total.unit_cost }}</td>
        <td>{{ gap_c.total.total_cost }}</td>
        <td>{{ gap_c.total.government_contribution }}</td>
        <td>{{ gap_c.total.population_affected }}</td>  
    </tr>
    {% endif %}
{% endfor %}
{% endfor %}
{% endfor %}
    <tr>
        <td></td>
        <td>Grand Total</td>
        <td>-</td>
        <td>-</td>
        <td>{{ total.number }}</td>       
        <td></td>
        <td>{{ total.total_cost }}</td>
        <td>{{ total.government_contribution }}</td>
        <td>{{ total.population_affected }}</td>  
    </tr>

</tbody>
</table>

</div>